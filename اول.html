<!DOCTYPE html>
<html lang="ar">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ุนุฏู ูุฑุจุญ</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="profile">
                <img src="https://g.top4top.io/p_3213hdy7h0.gif" alt="Profile" class="profile-pic">
                <div class="username-info">
                    <span class="username" id="username">ุงููุงุฏู ุงูุถู๐ฅณ</span>
                    <div class="user-id">ูุนุฑู ุงููุณุชุฎุฏู: <span id="userIdDisplay"></span></div>
                </div>
            </div>
            <div class="title">ุนุฏู ููุณุจ </div>
        </div>

        <div class="stats">
            <div class="token-info">
                <img src="https://g.top4top.io/p_3213e26ly0.png" alt="Token Icon" class="token-icon">
                <div class="points-count" id="points">0</div>
            </div>
            <div class="earn-rate">
                <span class="income"></span>  ุงุฑุจุญ/
                <span class="clicks">1 ุงูููุฑุฉ</span>
            </div>
        </div>

        <div class="character">
            <img src="https://i.imgur.com/DZvdHZt.png" alt="Cat Character" class="character-img animated" id="clickable-character">
        </div>

        <div class="task-section">
            <div class="energy">
                <span id="energy">500</span> / 500 ุงูุทุงูุฉ
            </div>
            <div class="tasks">
                <button class="task-button" onclick="navigateTo('tasks.html')">ุงูููุงู (18)</button>
            </div>
        </div>

        <!-- ุฃูุณุงู ุงูุชููู ุงูุณูููุฉ -->
        <div class="navigation">
            <button class="nav-button" onclick="navigateTo('ุงูู.html')">ุงูุฑุฆูุณูุฉ</button>
            <button class="nav-button" onclick="navigateTo('ูุญููู.html')">ุงูุฃุฑุจุงุญ</button>
            <button class="nav-button" onclick="navigateTo('fr.html')">ุงูุฃุตุฏูุงุก</button>
            <button class="nav-button" onclick="navigateTo('ุณุญุจ.html')">ุณุญุจ ุงูุงุฑุจุงุญ</button>
        </div>

        <!-- ุชูุจูู ูุฎุตุต ูููุงุฐ ุงูุทุงูุฉ -->
        <div id="energy-alert" class="energy-alert" style="display: none;">
            ููุฏ ููุฏุช ุทุงูุชู! ุงูุชุธุฑ ูููููุง ูุฒูุงุฏุฉ ุงูุทุงูุฉ.
        </div>
    </div>

    <script>
        let points = 0;
        let energy = 500;
        const maxEnergy = 500;
        const energyIncreaseInterval = 5 * 1000;
        const energyIncreaseAmount = 1;

        // ุงุณุชุฑุฌุงุน userId ูู URL ุงูุฎุงุต ุจุงูููุจ ุชููุฌุฑุงู ุฃู ูู ุงูุชุฎุฒูู ุงููุญูู
        const urlParams = new URLSearchParams(window.location.search);
        const userIdFromUrl = urlParams.get('userId');

        // ุฅุฐุง ูุงู userId ููุฌูุฏ ูู URLุ ูุฎุฒูู ูู Local Storage
        if (userIdFromUrl) {
            localStorage.setItem('userId', userIdFromUrl);
        }

        // ุงุณุชุฑุฌุงุน userId ูู Local Storage
        const userId = localStorage.getItem('userId');

        // ุงูุชุญูู ูู ุฃู userId ููุฌูุฏ
        if (!userId) {
            alert("ูู ูุชู ุงูุนุซูุฑ ุนูู ูุนุฑู ุงููุณุชุฎุฏู. ุชุฃูุฏ ูู ูุชุญ ุงูุชุทุจูู ุนุจุฑ ุชููุฌุฑุงู.");
        } else {
            document.getElementById('userIdDisplay').textContent = userId;

            // ุงุณุชุฑุฌุงุน ุจูุงูุงุช ุงููุณุชุฎุฏู ูู ุงูุฎุงุฏู
            fetch(`http://localhost:3000/api/user/${userId}`)
                .then(response => response.json())
                .then(data => {
                    if (data) {
                        points = data.points || 0;
                        energy = data.energy || 500;

                        document.getElementById('points').textContent = points;
                        document.getElementById('energy').textContent = energy;
                    }
                })
                .catch(error => console.error('ุฎุทุฃ ูู ุงุณุชุฑุฌุงุน ุจูุงูุงุช ุงููุณุชุฎุฏู:', error));

            // ุชุญุฏูุซ ุงูููุงุท ุนูุฏ ุงูููุฑ ุนูู ุงูุดุฎุตูุฉ
            document.getElementById('clickable-character').addEventListener('click', function () {
                if (energy > 0) {
                    points += 1;
                    energy--;
                    document.getElementById('points').textContent = points;
                    document.getElementById('energy').textContent = energy;

                    // ุชุญุฏูุซ ุจูุงูุงุช ุงููุณุชุฎุฏู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
                    fetch(`http://localhost:3000/api/user/${userId}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ points: points, energy: energy })
                    })
                    .then(response => response.json())
                    .then(data => console.log('ุชู ุชุญุฏูุซ ุจูุงูุงุช ุงููุณุชุฎุฏู:', data))
                    .catch(error => console.error('ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุชุญุฏูุซ ุงูุจูุงูุงุช:', error));
                } else {
                    document.getElementById('energy-alert').style.display = 'block';
                    setTimeout(() => {
                        document.getElementById('energy-alert').style.display = 'none';
                    }, 3000);
                }
            });

            // ุฒูุงุฏุฉ ุงูุทุงูุฉ ูู 5 ุซูุงูู
            setInterval(function () {
                if (energy < maxEnergy) {
                    energy++;
                    document.getElementById('energy').textContent = energy;

                    // ุชุญุฏูุซ ุงูุทุงูุฉ ููุท ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
                    fetch(`http://localhost:3000/api/user/${userId}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ energy: energy })
                    })
                    .catch(error => console.error('ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุชุญุฏูุซ ุงูุทุงูุฉ:', error));
                }
            }, energyIncreaseInterval);
        }

        // ุฏุงูุฉ ุงูุชููู ุจูู ุงูุตูุญุงุช
        function navigateTo(page) {
            window.location.href = page;
        }
    </script>
</body>
</html>
