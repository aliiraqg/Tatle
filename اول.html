<!DOCTYPE html>
<html lang="ar">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>عدن وربح</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="profile">
                <img src="https://g.top4top.io/p_3213hdy7h0.gif" alt="Profile" class="profile-pic">
                <div class="username-info">
                    <span class="username" id="username">القادم افضل🥳</span>
                    <div class="level"></div>
                </div>
            </div>
            <div class="title">عدن وكسب </div>
        </div>

        <div class="stats">
            <div class="token-info">
                <img src="https://g.top4top.io/p_3213e26ly0.png" alt="Token Icon" class="token-icon">
                <div class="points-count" id="points">0</div>
            </div>
            <div class="earn-rate">
                <span class="income"></span> اربح/
                <span class="clicks">1 النقرة</span>
            </div>
        </div>

        <div class="character">
            <img src="https://i.imgur.com/DZvdHZt.png" alt="Cat Character" class="character-img animated" id="clickable-character">
        </div>

        <div class="task-section">
            <div class="energy">
                <span>500</span> / 500 الطاقة
            </div>
            <div class="tasks">
                <button class="task-button" onclick="navigateTo('tasks.html')">المهام (18)</button>
            </div>
        </div>

        <div class="navigation">
            <button class="nav-button" onclick="navigateTo('اول.html')">الرئيسية</button>
            <button class="nav-button" onclick="navigateTo('محوله.html')">الأرباح</button>
            <button class="nav-button" onclick="navigateTo('fr.html')">الأصدقاء</button>
            <button class="nav-button" onclick="navigateTo('سحب.html')">سحب الارباح</button>
        </div>

        <div id="energy-alert" class="energy-alert" style="display: none;">
            لقد نفدت طاقتك! انتظر قليلًا لزيادة الطاقة.
        </div>

        <button class="delete-button" onclick="deleteAllUserData()">مسح جميع البيانات</button>
    </div>

    <script>
        let points = 0;
        let energy = 500;
        const maxEnergy = 500;
        const energyIncreaseInterval = 5 * 1000;
        const energyIncreaseAmount = 1; 
            document.getElementById('username').textContent = usernameFromUrl || "أنت الأفضل";
            points = parseInt(localStorage.getItem('points')) || 0;
            document.getElementById('points').textContent = points;

            const lastEnergyUpdateTime = localStorage.getItem('lastEnergyUpdateTime') || Date.now();
            const currentTime = Date.now();

            const timeDifference = currentTime - lastEnergyUpdateTime;
            const energyToRecover = Math.floor(timeDifference / energyIncreaseInterval) * energyIncreaseAmount;

            energy = Math.min(energy + energyToRecover, maxEnergy);
            document.querySelector('.energy span').textContent = energy;

            document.getElementById('clickable-character').addEventListener('click', async function () {
                if (energy > 0) {
                    points += 5;
                    energy--;
                    document.getElementById('points').textContent = points;
                    document.querySelector('.energy span').textContent = energy;
                    localStorage.setItem('points', points);

                    try {
                        const response = await fetch('http://localhost:3000/web_app_data', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({ userId: userId, points: points })
                        });
                        const data = await response.json();
                        console.log('تم إرسال البيانات إلى الخادم:', { userId: userId, points: points });
                    } catch (error) {
                        console.error('حدث خطأ أثناء إرسال البيانات إلى الخادم:', error);
                    }

                    localStorage.setItem('lastActivityTime', Date.now());
                    localStorage.setItem('lastEnergyUpdateTime', Date.now());
                } else {
                    showCustomAlert('لقد نفذت طاقتك! انتظر قليلًا لزيادة الطاقة.');
                }
            });

            setInterval(function () {
                if (energy < maxEnergy) {
                    energy++;
                    document.querySelector('.energy span').textContent = energy;
                    localStorage.setItem('lastEnergyUpdateTime', Date.now());
                }
            }, energyIncreaseInterval);
        }

        function navigateTo(page) {
            window.location.href = page;
        }

        function showCustomAlert(message) {
            const alertContainer = document.createElement('div');
            alertContainer.classList.add('custom-alert');
            alertContainer.textContent = message;

            document.body.appendChild(alertContainer);

            setTimeout(() => {
                document.body.removeChild(alertContainer);
            }, 3000);
        }

        async function deleteAllUserData() {
            try {
                const response = await fetch('http://localhost:3000/deleteAllUsers', {
                    method: 'DELETE',
                });

                if (response.ok) {
                    alert('تم مسح جميع بيانات المستخدمين بنجاح.');
                    localStorage.clear();
                    window.location.reload();
                } else {
                    console.error('❌ حدث خطأ أثناء مسح بيانات المستخدمين:', response.statusText);
                }
            } catch (error) {
                console.error('❌ خطأ أثناء محاولة مسح البيانات:', error);
            }
        }

        document.addEventListener('gesturestart', function (e) {
            e.preventDefault();
        });
        document.addEventListener('gesturechange', function (e) {
            e.preventDefault();
        });
        document.addEventListener('gestureend', function (e) {
            e.preventDefault();
        });

        document.addEventListener('copy', function (e) {
            e.preventDefault();
        });
        document.addEventListener('cut', function (e) {
            e.preventDefault();
        });
        document.addEventListener('paste', function (e) {
            e.preventDefault();
        });
    </script>
    <script src="script.js"></script>
</body>
</html>
