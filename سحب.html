<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>سحب الأرباح</title>
    <link rel="stylesheet" href="سحب.css">
</head>
<body>
    <div class="container">
        <h1>سحب الأرباح</h1>

        <!-- عرض رصيد النقاط الحالي -->
        <div class="balance">
            <p>رصيد النقاط الخاص بك: <span id="currentPoints">0</span></p>
        </div>

        <!-- تحديد وسيلة السحب -->
        <div class="input-box">
            <label for="withdrawOption">اختر وسيلة السحب:</label>
            <div class="custom-select">
                <select id="withdrawOption" class="select-option">
                    <option value="" disabled selected>اختر وسيلة السحب</option>
                    <option value="زين كاش">زين كاش</option>
                    <option value="أسيا سيل">أسيا سيل</option>
                    <option value="USDT">USDT</option>
                    <option value="فودافون كاش">فودافون كاش</option>
                </select>
            </div>
        </div>

        <!-- إدخال المبلغ ورقم الحساب والبريد الإلكتروني -->
        <input type="text" id="withdrawAmount" placeholder="أدخل المبلغ" required>
        <input type="text" id="withdrawDetails" placeholder="أدخل رقم الحساب أو التفاصيل" required>
        <input type="email" id="emailAddress" placeholder="أدخل بريدك الإلكتروني" required>

        <button class="submit" onclick="submitWithdrawal()">سحب الأرباح</button>
    </div>

    <script>
        // استرجاع النقاط من LocalStorage وعرضها
        const userPoints = localStorage.getItem('userPoints');
        document.getElementById('currentPoints').textContent = userPoints || 0;

        // توكن البوت ومعرف الـ Chat ID الخاص بك
        const botToken = '7891399266:AAEDdHQbEzH42ZAZqxzgrnSnGdU2Lr1L0BI';  // استبدل بالتوكن الخاص بك
        const chatId = '7087626468';  // استبدل بـ Chat ID الخاص بك

        // دالة لإرسال الإشعار إلى Telegram
        function sendTelegramNotification(amount, details, email, method, points) {
            const message = `
                تم تقديم طلب سحب جديد:
                - المبلغ: ${amount}
                - وسيلة السحب: ${method}
                - التفاصيل: ${details}
                - البريد الإلكتروني: ${email}
                - رصيد النقاط: ${points}
            `;

            const telegramApiUrl = `https://api.telegram.org/bot${botToken}/sendMessage?chat_id=${chatId}&text=${encodeURIComponent(message)}`;

            fetch(telegramApiUrl)
                .then(response => response.json())
                .then(data => {
                    if (data.ok) {
                        alert('تم إرسال طلب السحب بنجاح وتم إشعار البوت!');
                    } else {
                        alert('حدث خطأ في إرسال الإشعار إلى Telegram');
                    }
                })
                .catch(error => {
                    console.error('تعذر إرسال الإشعار إلى Telegram:', error);
                    alert('تعذر إرسال الإشعار إلى Telegram');
                });
        }

        // دالة معالجة السحب
        function submitWithdrawal() {
            const amount = document.getElementById('withdrawAmount').value;
            const details = document.getElementById('withdrawDetails').value;
            const email = document.getElementById('emailAddress').value;
            const method = document.getElementById('withdrawOption').value;
            const points = userPoints || 0;

            // التحقق من إدخال كافة المعلومات
            if (amount && details && email && method) {
                alert(`تم تقديم طلب السحب بنجاح بمبلغ ${amount} نقاط.`);
                
                // إرسال الإشعار إلى Telegram
                sendTelegramNotification(amount, details, email, method, points);
            } else {
                alert('يرجى ملء جميع الحقول المطلوبة.');
            }
        }
    </script>
</body>
</html>
